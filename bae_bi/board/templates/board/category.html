{% extends "./base.html" %} {% load static %}{% block main %}

<style>

  .tab .tabitems {
    width: 100%;
    position: relative;
  }

  .tab .tabitems .item {
    display: inline-block;
    width: 49%;
  }

  .tab .tabitems li a {
    display: block;
    margin-right: 0;
    color: #333;
    font-size: 15px;
    text-align: center;
    height: 50px;
    line-height: 50px;
    font-weight: bold;
    text-decoration: none;
  }

  .tab .tabitems li a.active,
  .tab .tabitems li a:hover {
    color: #005555;
  }

  .tab .tabitems .item:last-child .tablink.active:after {
  content: "";
  width: 48%;
  height: 1px;
  background-color: #E2E2E1;
  position: absolute;
  bottom: 0;
  left: 0;
  }


</style>

<script> //드래그 앤 드롭 스크립트
  function dragstart_handler(ev) {
    console.log("dragStart");
    //ev.currentTarget.style.border = "dashed";
    ev.dataTransfer.setData("text", ev.target.id);
    ev.effectAllowed = "copyMove";
  }
  function dragover_handler(ev) {
    console.log("dragOver");
    //ev.currentTarget.style.background = "lightblue";
    ev.preventDefault();
  }
  let cart_list = [];
  function drop_handler(ev) {
    console.log("Drop");
    ev.preventDefault();
    var id = ev.dataTransfer.getData("text");
    if (!cart_list.includes("_" + id) && ev.target.id == "dest_copy") {
      var nodeCopy = document.getElementById(id).cloneNode(true);
      nodeCopy.style.height = "70px";
      const button = document.createElement("button");
      button.className = "btn btn-close";
      button.onclick = () => {
        remove_cart("_" + id,ev)
      };
      button.ariaLabel="Close";
      button.type = "button";
      nodeCopy.appendChild(button)
      nodeCopy.id = "_" + id
      ev.target.appendChild(nodeCopy);
      cart_list.push("_" + id);
    }
  }

  function remove_element(ev){
    console.log('del');
    ev.dataTransfer.setData("text", ev.target.id);
  }

  function remove_cart(id,ev) {
    if (cart_list.includes(id) && ev.target.id == "dest_copy") {
      const child = document.getElementById(id);
      ev.target.removeChild(child);
      var idx = cart_list.indexOf(id)
      cart_list.splice(idx,1);
    }
  }


  
  function dragend_handler(ev) {
    console.log("dragEnd");
    //ev.target.style.border = "solid black";
  }

</script>

<script>// 요소 생성, 제거 스크립트

function switch_Display() {
  if(document.getElementById("Display_On_Off").style.display == "none") {
    document.getElementById("Display_On_Off").style.display = "block";
  } else {
    document.getElementById("Display_On_Off").style.display = "none";
  }
}

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = cookies[i].trim();
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
  var csrftoken = getCookie('csrftoken');

  function csrfSafeMethod(method) {
      // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }
  $.ajaxSetup({
      beforeSend: function(xhr, settings) {
          if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
              xhr.setRequestHeader("X-CSRFToken", csrftoken);
          }
      }
  });
</script>

<script type="text/javascript">
  $(document).on('submit', '#post-form', function(e){
    e.preventDefault();
    $.ajax({
      type: 'POST',
      url: '/update',
      data:{
        store_name: $('#store_name').val()
      },
      success: function(data){
        const menu = JSON.parse(data)
        let menu_html = []
        for(const me of menu){
          menu_html.push('<li style="height: 100pt" class="list-group-item" draggable="true" id="'+ me.name +'" ondragstart="dragstart_handler(event);" ondragend="dragend_handler(event);"><p><strong>' + me.name+ '</strong> | ' + me.name + '</p><p>' + me.name + '</p></li>')
          console.log(me.name);
        }
        $('#store-detail').html(menu_html)
      }

    })
  })

</script>



<div style="display: flex">
  <!-- start -->
  <div>
    <div class="z-0 position-absolute card" style="width: 80%;">

      <div class="container">
        <div class="row justify-content-between">
          <div style="margin-top: 5px;">
            <ul class="list-group" style="row-gap: 3px; margin: 3px">
              {% for store in cat_list.store_list %}
                <li style="height: 100pt;" class="list-group-item">
                  <form action="" id="post-form">
                    {% csrf_token %}
                    <button id="store_name" style="text-align: left;" type="submit" onclick="switch_Display();" name="store_name"><strong>{{store.name}}</strong></button>
                    <p style="text-align: left;">{{store.distance}} | {{store.review}}점</p>
                  </form>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    
    </div>

    <div class="z-1 position-absolute card" id="Display_On_Off" style="display: none; width: 80%;">
      <button type="button" aria-label="Close" class="btn btn-close" onclick="switch_Display()" style="float: right;"></button>
      <div class="container">
      <!-- store list element start -->
        <div class="tab">
          <ul class="tabitems">
            <li class="item" style="display: inline-block; width: 10%;">
              <a class="tablink active" href="#" onclick="openTab(event, 'tabA')">가게 메뉴</a>
            </li>
            <li class="item" style="display: inline-block; width: 10%;">
              <a class="tablink" href="#" onclick="openTab(event, 'tabB')">리뷰 보기</a>
            </li>
          </ul>
        </div>
      
      <!--tabA start-->                                 
          <div id="tabA" class="tabcontent" style="display: block;">
            <p>가게 메뉴<br> 가게 메뉴들이 표기 되는 부분 </p>
            <div id="store-detail"></div>
          </div>
          <!--tabA end-->
          <!--tabB start-->  
          <div id="tabB" class="tabcontent" style="display: none;">
            <p>리뷰<br> 리뷰 리스트가 표기되는 부분, 작성도 가능하다. </p>
          </div>
        </div>
      <!-- store list element end -->
      <script>
        function openTab(evt, tabName) {
          var i, tabcontent, tablink;
          tabcontent = document.getElementsByClassName("tabcontent");
          for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
          }
          tablink = document.getElementsByClassName("tablink");
          for (i = 0; i < tablink.length; i++) {
            tablink[i].className = tablink[i].className.replace(" active", "");
          }
          document.getElementById(tabName).style.display = "block";
          evt.currentTarget.className += " active";
        }
      </script>
      </div>
    </div>
  </div>
  <!-- end -->

  <!-- cart start -->
  <div style="width: 20%; margin-right: 10px; position: fixed; margin-left: 80%; height: 600px;" class="card">
    <strong class="card-body" id="dest_copy" ondrop="drop_handler(event);" ondragover="dragover_handler(event);">cart</strong>
      <center>
          <button
              class="btn btn-outline-success active"
              style="
              width: 70%;
              margin-bottom: 1pt;
              background-color: #005555;
              justify-content: center;
              ">비교
          </button>
      </center>
  </div>

  <!-- cart end -->


</div>
{% endblock main %}
